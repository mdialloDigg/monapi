<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Liste des transferts</title>

<style>
:root {
  --primary:#4f46e5;
  --success:#16a34a;
}
body {
  font-family: Segoe UI, Arial;
  background:#f8fafc;
  padding:20px;
}
table {
  width:100%;
  background:white;
  border-collapse:collapse;
}
th,td {
  padding:10px;
  border-bottom:1px solid #e5e7eb;
  text-align:center;
}
th { background:var(--primary); color:white; }
.total-form {
  margin-top:30px;
  background:white;
  padding:20px;
}
</style>
</head>

<body>

<h2>ðŸ’¸ Liste des transferts</h2>

<div id="content" style="display:none;">

<table>
<thead>
<tr>
<th>ExpÃ©diteur</th><th>Montant</th><th>Frais</th>
<th>Destinataire</th><th>ReÃ§u</th><th>Code</th><th>Date</th>
</tr>
</thead>
<tbody id="usersTable">
<tr><td colspan="7">Chargement...</td></tr>
</tbody>
</table>

<div class="total-form">
<h3>ðŸ“Š Totaux</h3>
<input id="totalAmount" readonly>
<input id="totalFees" readonly>
<input id="totalReceived" readonly>
</div>

</div>

<script>
const code = prompt("Code d'accÃ¨s");
if (code !== "123") {
  document.body.innerHTML = "<h2>AccÃ¨s refusÃ©</h2>";
} else {
  document.getElementById('content').style.display = "block";
  loadUsers();
}

async function loadUsers(){
  const res = await fetch('/users/json');
  const users = await res.json();

  let ta=0, tf=0, tr=0;
  const t = document.getElementById('usersTable');
  t.innerHTML="";

  users.forEach(u=>{
    ta+=+u.amount;
    tf+=+u.fees;
    tr+=+u.recoveryAmount;

    t.innerHTML+=`
    <tr>
      <td>${u.senderFirstName}</td>
      <td>${u.amount}</td>
      <td>${u.fees}</td>
      <td>${u.receiverFirstName}</td>
      <td>${u.recoveryAmount}</td>
      <td>${u.code}</td>
      <td>${new Date(u.createdAt).toLocaleString()}</td>
    </tr>`;
  });

  totalAmount.value = ta;
  totalFees.value = tf;
  totalReceived.value = tr;
}
</script>

</body>
</html>
